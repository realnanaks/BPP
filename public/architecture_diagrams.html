<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Architecture Diagrams</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'dark' });
    </script>
    <style>
        body {
            background-color: #0f0f17;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #facc15; /* Betika Yellow */
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        h2 {
            margin-top: 40px;
            color: #a855f7; /* Accent Purple */
        }
        .diagram-container {
            background: #1a1a24;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #333;
            margin-top: 20px;
            overflow-x: auto;
        }
        p {
            color: #a1a1aa;
            line-height: 1.6;
        }
    </style>
</head>
<body>

    <h1>Promotion Engine: System Architecture</h1>
    <p>This document visualizes the structure and data flow of the Promotion Engine prototype.</p>

    <h2>1. Conceptual Data Model</h2>
    <p>The relationship between the core Promotion entity and its configuration modules (Eligibility, Rewards, Schedule, Display).</p>
    <div class="mermaid diagram-container">
erDiagram
    PROMOTION ||--|| ELIGIBILITY_RULES : defines
    PROMOTION ||--|| REWARD_MECHANICS : grants
    PROMOTION ||--|| SCHEDULE_CONFIG : follows
    PROMOTION ||--|| DISPLAY_SETTINGS : rendered_as
    PROMOTION ||--o{ ANALYTICS_METRICS : generates

    ELIGIBILITY_RULES {
        string[] markets "e.g., KE, ET"
        string[] channels "e.g., Mobile, Web"
        string segment "Target Audience"
        object[] triggers "Events triggering promo"
    }

    REWARD_MECHANICS {
        string type "Cashback, Bonus, etc."
        string calculation_mode "Flat vs Tiered"
        object[] tiers "Payout levels"
        int wagering_requirement
    }

    SCHEDULE_CONFIG {
        datetime start_date
        datetime end_date
        boolean is_recurring
        object limits "Budget caps, Claims/user"
    }

    DISPLAY_SETTINGS {
        string title
        string teaser
        string banner_url
        string terms_conditions
        string[] badges
    }

    DISPLAY_SETTINGS ||--o{ COMM_CHANNEL : notifies_via

    COMM_CHANNEL {
        string type "SMS, Push"
        string template "Message Content"
        boolean enabled
    }
    </div>

    <h2>2. Technical Architecture & Data Flow</h2>
    <p>Interaction flow between the User Interface (Next.js), State Management (Context API), and the Mock Backend Layer.</p>
    <div class="mermaid diagram-container">
graph TD
    subgraph "Client Layer (Browser)"
        User[CRM Manager]
        LocalStorage[(Browser Storage)]
    end

    subgraph "Application Layer (Next.js)"
        Router[App Router]
        
        subgraph "Promotion Wizard Module"
            WizardCtx[WizardContext Provider]
            Orchestrator[CreatePromotionWizard.tsx]
            
            subgraph "Steps Components"
                Step1[Basics]
                Step2[Eligibility]
                Step4[Rewards]
                Step5[Schedule]
                Step6[Display & Preview]
                Step7[Review]
            end
        end
        
        Dashboard[Dashboard Pages]
    end

    subgraph "API Layer (Server-Side)"
        RouteHandler[POST /api/promotions/create]
        Validator[Data Validation]
        MockDB[Mock DB Logic]
    end

    %% Flows
    User -->|Interacts| Orchestrator
    Orchestrator -->|Reads/Writes| WizardCtx
    WizardCtx -->|State| Step1
    WizardCtx -->|State| Step2
    WizardCtx -->|State| Step6
    
    Step6 -->|Live Preview| User
    Step6 -->|Uploads Image| WizardCtx
    
    Orchestrator -->|Publish| RouteHandler
    RouteHandler -->|Validate| Validator
    Validator -->|Persist| MockDB
    
    Orchestrator -->|Sync State| LocalStorage
    Dashboard -->|Read History| LocalStorage
    </div>

</body>
</html>
